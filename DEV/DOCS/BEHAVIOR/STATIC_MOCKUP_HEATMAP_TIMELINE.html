<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Timeline Heatmap - High Fidelity Mockup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* From index.css */
        body { background-color: #09090b; color: #fafafa; }
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        .panel-transition { transition: width 0.3s ease-in-out, opacity 0.3s ease-in-out; }
        
        /* Heatmap Specific Styles from TimelineHeatmapPlugin.ts */
        .heatmap-table { border-collapse: separate; border-spacing: 2px; font-family: monospace; }
        .sticky-corner { position: sticky; left: 0; top: 0; z-index: 40; background: #18181b; border-bottom: 1px solid #27272a; }
        .sticky-time { position: sticky; top: 0; z-index: 30; background: #18181b; border-bottom: 1px solid #27272a; }
        .sticky-dir { 
            position: sticky; left: 0; z-index: 20; background: #242429; 
            border-right: 1px solid #27272a; border-bottom: 2px dashed #27272a; 
        }
        
        .heatmap-cell {
            transition: all 0.1s;
            user-select: none;
            cursor: pointer;
        }
        .heatmap-cell:hover { transform: scale(1.1); z-index: 10; outline: 1px solid white; }
    </style>
</head>
<body x-data="heatmapApp()" class="h-screen flex flex-col overflow-hidden">

    <!-- HEADER (App.tsx) -->
    <header class="h-14 bg-zinc-900 border-b border-zinc-800 flex items-center justify-between px-4 flex-none z-50">
        <div class="flex items-center gap-4">
            <div class="flex flex-col">
                <h1 class="text-sm font-bold leading-tight">Git Repository Visualization</h1>
                <p class="text-[10px] text-zinc-500 font-mono leading-tight">excalidraw</p>
            </div>
            <div class="h-8 w-px bg-zinc-800"></div>
            
            <!-- Plugin Selector -->
            <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-zinc-900 border border-zinc-800 text-zinc-300 text-sm">
                <i data-lucide="layout-grid" class="w-4 h-4 text-purple-500"></i>
                <span>Timeline Heatmap</span>
                <i data-lucide="chevron-down" class="w-3 h-3 text-zinc-500"></i>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <!-- Metric Selector (MetricSelector.tsx) -->
            <div class="flex bg-zinc-950 rounded-lg p-1 border border-zinc-800">
                <template x-for="m in metrics">
                    <button @click="state.metric = m.id"
                        :class="state.metric === m.id ? 'bg-purple-900/50 text-purple-200 border border-purple-700/50' : 'text-zinc-400 hover:text-zinc-200'"
                        class="flex items-center gap-2 px-3 py-1 rounded-md text-xs font-medium transition-all border border-transparent">
                        <i :data-lucide="m.icon" class="w-3.5 h-3.5"></i>
                        <span x-text="m.label"></span>
                    </button>
                </template>
            </div>

            <!-- Time Bin Selector (TimeBinSelector.tsx) -->
            <div class="flex bg-zinc-950 rounded-lg p-1 border border-zinc-800">
                <template x-for="b in bins">
                    <button @click="state.timeBin = b.id"
                        :class="state.timeBin === b.id ? 'bg-zinc-700 text-white' : 'text-zinc-400 hover:text-zinc-200'"
                        class="px-3 py-1 rounded-md text-xs font-medium transition-all"
                        x-text="b.label"></button>
                </template>
            </div>

            <div class="h-8 w-px bg-zinc-800"></div>

            <!-- Filter Toggle -->
            <button @click="toggleFilters()" 
                :class="ui.showFilters ? 'bg-purple-600 text-white' : 'bg-zinc-800 text-zinc-400'"
                class="p-2 rounded-lg relative transition-all">
                <i data-lucide="filter" class="w-4.5 h-4.5"></i>
                <span x-show="state.selectedExtensions.length > 0" class="absolute top-1 right-1 w-1.5 h-1.5 bg-purple-400 rounded-full shadow-[0_0_8px_rgba(168,85,247,0.8)]"></span>
            </button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- HEATMAP GRID -->
        <main class="flex-1 overflow-auto bg-[#09090b] relative">
            <table class="heatmap-table">
                <thead>
                    <tr>
                        <th class="sticky-corner p-3 text-left min-w-[250px]">
                            <div class="text-xs text-zinc-400">Directory</div>
                            <div class="text-[10px] text-zinc-600 font-normal">Top 20 by Activity</div>
                        </th>
                        <template x-for="bin in data.timeBins">
                            <th class="sticky-time p-2 text-[10px] text-zinc-500 font-normal min-w-[60px]" x-text="bin"></th>
                        </template>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="(row, rowIndex) in data.rows">
                        <tr>
                            <th class="sticky-dir p-2 text-[11px] text-zinc-300 font-mono text-left whitespace-nowrap" x-text="row.path"></th>
                            <template x-for="(cell, colIndex) in row.cells">
                                <td @click="selectCell(cell, row.path, data.timeBins[colIndex])"
                                    :style="getCellStyle(cell)"
                                    :class="{
                                        'border-b-2 border-green-600': cell.creations > 0,
                                        'border-t-2 border-red-600': cell.deletions > 0
                                    }"
                                    class="heatmap-cell h-8 text-[10px] font-bold text-center align-middle"
                                    x-text="cell[state.metric] > 0 ? cell[state.metric] : ''">
                                </td>
                            </template>
                        </tr>
                    </template>
                </tbody>
            </table>
        </main>

        <!-- FILTER PANEL (FilterPanel.tsx) -->
        <aside x-show="ui.showFilters" x-cloak
            class="w-80 bg-zinc-900 border-l border-zinc-800 flex flex-col panel-transition shadow-xl">
            <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <i data-lucide="filter" class="w-4 h-4 text-purple-400"></i>
                    <h2 class="font-bold text-sm">Filters</h2>
                </div>
                <button @click="ui.showFilters = false"><i data-lucide="x" class="w-4 h-4 text-zinc-500"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-6">
                <!-- Authors -->
                <div>
                    <label class="text-[10px] uppercase text-zinc-500 font-bold tracking-widest mb-3 block">Authors</label>
                    <div class="relative mb-3">
                        <i data-lucide="search" class="w-3.5 h-3.5 absolute left-3 top-2.5 text-zinc-500"></i>
                        <input type="text" placeholder="Search authors..." class="w-full bg-zinc-800 border border-zinc-700 rounded-lg pl-9 py-2 text-xs text-zinc-200 focus:outline-none focus:border-purple-500">
                    </div>
                    <div class="space-y-2">
                        <template x-for="author in data.authors">
                            <div class="flex items-center justify-between p-2 bg-zinc-800 border border-zinc-700 rounded-lg text-xs cursor-pointer hover:border-purple-500">
                                <span class="text-zinc-300 truncate" x-text="author.name"></span>
                                <span class="text-zinc-500 font-mono" x-text="author.count"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- File Types -->
                <div>
                    <label class="text-[10px] uppercase text-zinc-500 font-bold tracking-widest mb-3 block">File Types</label>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="ext in data.extensions">
                            <button @click="toggleExtension(ext.name)"
                                :class="state.selectedExtensions.includes(ext.name) ? 'bg-purple-600 text-white' : 'bg-zinc-800 text-zinc-400 border-zinc-700'"
                                class="px-3 py-1.5 rounded-full border text-[10px] font-mono transition-all">
                                <span x-text="ext.name"></span> <span class="opacity-50 ml-1" x-text="ext.count"></span>
                            </button>
                        </template>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t border-zinc-800">
                <button @click="state.selectedExtensions = []" class="w-full py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-xs font-medium flex items-center justify-center gap-2">
                    <i data-lucide="rotate-ccw" class="w-3.5 h-3.5"></i> Reset All Filters
                </button>
            </div>
        </aside>

        <!-- DETAIL PANEL (CellDetailPanel.tsx) -->
        <aside x-show="ui.selectedCell" x-cloak
            class="w-80 bg-zinc-900/95 backdrop-blur border-l border-zinc-700 flex flex-col shadow-2xl animate-in slide-in-from-right-10">
            
            <!-- Header -->
            <div class="p-4 border-b border-zinc-800 bg-zinc-950/50 flex justify-between items-start">
                <div>
                    <div class="flex items-center gap-2 text-purple-400 mb-1">
                        <i :data-lucide="metrics.find(m => m.id === state.metric).icon" class="w-3.5 h-3.5"></i>
                        <span class="text-[10px] font-bold uppercase tracking-wider" x-text="metrics.find(m => m.id === state.metric).label"></span>
                    </div>
                    <h3 class="text-sm font-bold text-white font-mono break-all" x-text="ui.selectedCell?.dirName"></h3>
                    <div class="text-[10px] text-zinc-500 truncate" x-text="ui.selectedCell?.path"></div>
                </div>
                <button @click="ui.selectedCell = null"><i data-lucide="x" class="w-4 h-4 text-zinc-500"></i></button>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-px bg-zinc-800 border-b border-zinc-800">
                <div class="bg-zinc-900 p-4 text-center">
                    <div class="text-2xl font-bold text-purple-400" x-text="ui.selectedCell?.cell[state.metric]"></div>
                    <div class="text-zinc-500 text-[10px] uppercase tracking-wider mt-1" x-text="state.metric"></div>
                </div>
                <div class="bg-zinc-900 p-4 text-center">
                    <div class="text-2xl font-bold text-white" x-text="ui.selectedCell?.cell.authors"></div>
                    <div class="text-zinc-500 text-[10px] uppercase tracking-wider mt-1">Authors</div>
                </div>
            </div>

            <!-- Event Composition Chart -->
            <div class="p-4 bg-zinc-900 border-b border-zinc-800">
                <div class="text-[10px] text-zinc-400 mb-3 font-bold uppercase tracking-widest">Event Composition</div>
                <div class="h-3 w-full flex rounded-full overflow-hidden mb-3 bg-zinc-800">
                    <div :style="`width: ${ui.selectedCell?.pCreate}%`" class="bg-green-500"></div>
                    <div :style="`width: ${ui.selectedCell?.pMod}%`" class="bg-blue-500"></div>
                    <div :style="`width: ${ui.selectedCell?.pDelete}%`" class="bg-red-500"></div>
                </div>
                <div class="flex justify-between text-[10px] text-zinc-500 font-mono">
                    <span class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> +<span x-text="ui.selectedCell?.cell.creations"></span></span>
                    <span class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-blue-500"></div> ~<span x-text="ui.selectedCell?.cell.modifications"></span></span>
                    <span class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-red-500"></div> -<span x-text="ui.selectedCell?.cell.deletions"></span></span>
                </div>
            </div>

            <!-- Contributors -->
            <div class="p-4 bg-zinc-900 flex-1 overflow-y-auto space-y-4">
                <div>
                    <div class="text-[10px] text-zinc-400 mb-2 font-bold uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="user" class="w-3 h-3"></i> Top Contributors
                    </div>
                    <div class="space-y-1.5">
                        <template x-for="auth in ['dwelle', 'lipis', 'pomber']">
                            <div class="text-xs text-zinc-300 truncate pl-3 border-l-2 border-zinc-700 hover:border-orange-500 transition-colors" x-text="auth"></div>
                        </template>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-zinc-950 text-[10px] text-zinc-500 flex items-center gap-2">
                <i data-lucide="calendar" class="w-3 h-3"></i>
                <span>Period: <span x-text="ui.selectedCell?.bin"></span></span>
            </div>
        </aside>
    </div>

    <script>
        function heatmapApp() {
            return {
                state: {
                    metric: 'events',
                    timeBin: 'week',
                    selectedAuthors: [],
                    selectedExtensions: ['.tsx', '.ts']
                },
                ui: {
                    showFilters: true,
                    selectedCell: null
                },
                metrics: [
                    { id: 'commits', label: 'Commits', icon: 'git-commit' },
                    { id: 'events', label: 'Events', icon: 'activity' },
                    { id: 'authors', label: 'Authors', icon: 'users' }
                ],
                bins: [
                    { id: 'day', label: 'Day' },
                    { id: 'week', label: 'Week' },
                    { id: 'month', label: 'Month' },
                    { id: 'quarter', label: 'Quarter' }
                ],
                data: {
                    timeBins: [],
                    rows: [],
                    authors: [
                        { name: 'dwelle', count: 1420 },
                        { name: 'lipis', count: 890 },
                        { name: 'pomber', count: 432 },
                        { name: 'adrianheine', count: 211 }
                    ],
                    extensions: [
                        { name: '.tsx', count: 615 },
                        { name: '.ts', count: 712 },
                        { name: '.json', count: 211 },
                        { name: '.scss', count: 180 }
                    ],
                    maxValue: 50
                },

                init() {
                    // Generate fake timeline
                    for(let i=1; i<=25; i++) this.data.timeBins.push(`W${i}, 2024`);
                    
                    // Generate fake rows
                    const paths = ['src/packages/excalidraw', 'src/element', 'src/actions', 'src/renderer', 'src/locales', 'src/css', 'src/tests'];
                    this.data.rows = paths.map(p => ({
                        path: p,
                        cells: Array.from({ length: 25 }, () => {
                            const events = Math.floor(Math.random() * 50);
                            return {
                                events: events,
                                commits: Math.floor(events * 0.6),
                                authors: Math.floor(Math.random() * 5) + 1,
                                creations: Math.random() > 0.8 ? Math.floor(Math.random() * 10) : 0,
                                deletions: Math.random() > 0.9 ? Math.floor(Math.random() * 5) : 0,
                                modifications: Math.floor(Math.random() * 20)
                            };
                        })
                    }));

                    // Initialize Lucide icons
                    this.$nextTick(() => lucide.createIcons());
                },

                getCellStyle(cell) {
                    const val = cell[this.state.metric];
                    if (val === 0) return 'background-color: #18181b; color: transparent;';
                    
                    // Logic from TimelineHeatmapPlugin.ts
                    const intensity = Math.log(val + 1) / Math.log(this.data.maxValue + 1);
                    
                    let hue = 145; // Events (Green)
                    if (this.state.metric === 'authors') hue = 30; // Authors (Orange)
                    if (this.state.metric === 'commits') hue = 210; // Commits (Blue)

                    const lightness = 10 + (intensity * 50);
                    const bg = `hsl(${hue}, 70%, ${lightness}%)`;
                    
                    // Contrast logic
                    const textColor = lightness > 50 ? '#000' : '#fff';
                    
                    return `background-color: ${bg}; color: ${textColor};`;
                },

                toggleFilters() {
                    this.ui.showFilters = !this.ui.showFilters;
                    if (this.ui.showFilters) this.ui.selectedCell = null;
                    this.$nextTick(() => lucide.createIcons());
                },

                toggleExtension(ext) {
                    if (this.state.selectedExtensions.includes(ext)) {
                        this.state.selectedExtensions = this.state.selectedExtensions.filter(e => e !== ext);
                    } else {
                        this.state.selectedExtensions.push(ext);
                    }
                },

                selectCell(cell, path, bin) {
                    const total = cell.creations + cell.deletions + cell.modifications;
                    this.ui.selectedCell = {
                        cell,
                        path,
                        dirName: path.split('/').pop(),
                        bin,
                        pCreate: total ? (cell.creations / total) * 100 : 0,
                        pDelete: total ? (cell.deletions / total) * 100 : 0,
                        pMod: total ? (cell.modifications / total) * 100 : 0
                    };
                    this.ui.showFilters = false;
                    this.$nextTick(() => lucide.createIcons());
                }
            }
        }
    </script>
</body>
</html>